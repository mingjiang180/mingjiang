name: Test Docker-in-Docker (Build Only)

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: arc-runner-set22

    steps:
      - name: ğŸ§ª Check Docker Connectivity
        run: docker --tlscacert="" version

      - name: ğŸ“¥ Checkout Code
        uses: actions/checkout@v4
        # æ­¤æ—¶ä»“åº“ä¸­çš„ Dockerfile å·²å¯ç”¨
      - name: Debug secrets (DO NOT USE IN PRODUCTION)
        run: |
          echo "User: ${{ secrets.REGISTRY_USER }}"
          
      - name: Log in to Docker Hub
        uses: docker/login-action@v3
        with:
          username: ${{ secrets.REGISTRY_USER }}
          password: ${{ secrets.REGISTRY_PASS }}  # å¼ºçƒˆå»ºè®®ç”¨ Token è€Œéå¯†ç ï¼
          
      - name: ğŸ—ï¸ Build Docker Image
        run: |
          IMAGE_NAME=test-dind:${GITHUB_SHA::8}
          docker  build -t $IMAGE_NAME .

      - name: ğŸ” Verify Image
        run: docker  images | grep test-dind

      - name: ğŸ§¹ Cleanup
        if: always()
        run: docker system prune -af
